name: 'Terraform'

on:
  push:
    branches:
    - main
  pull_request:


jobs:
  terraform:
    name: 'Terraform'
    runs-on: ubuntu-latest
    environment: production
    env :
      AWS_ACCESS_KEY_ID : 'AKIASM7IGSBICRV47B2W'
      AWS_SECRET_KEY_ID :  'afKNuo/wF6KMYNJiAPBwUf3f2+M2pfxG3F860rCm'
      AWS_REGION : 'us-east-1'

    # Use the Bash shell regardless whether the GitHub Actions runner is ubuntu-latest, macos-latest, or windows-latest
    defaults:
      run:
        shell: bash

    steps:
steps:
- task: TerraformInstaller@0
  inputs:
    terraformVersion: 'latest'

- task: TerraformTaskV3@3
  inputs:
    provider: 'azurerm'
    command: 'init'
    env :
      AWS_ACCESS_KEY_ID : 'AKIASM7IGSBICRV47B2W'
      AWS_SECRET_KEY_ID :  'afKNuo/wF6KMYNJiAPBwUf3f2+M2pfxG3F860rCm'
      AWS_REGION : 'us-east-1'

- task: TerraformTaskV3@3
  inputs:
    provider: 'azurerm'
    command: 'validate'

- task: TerraformTaskV3@3
  inputs:
    provider: 'azurerm'
    command: 'plan'
    env :
      AWS_ACCESS_KEY_ID : 'AKIASM7IGSBICRV47B2W'
      AWS_SECRET_KEY_ID :  'afKNuo/wF6KMYNJiAPBwUf3f2+M2pfxG3F860rCm'
      AWS_REGION : 'us-east-1'

- task: TerraformTaskV3@3
  inputs:
    provider: 'azurerm'
    command: 'apply'
